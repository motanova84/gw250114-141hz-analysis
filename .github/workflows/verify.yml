name: ğŸ” VerificaciÃ³n de Repositorio

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]
  workflow_dispatch:  # Permite ejecuciÃ³n manual

jobs:
  verificacion:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout del repositorio
      uses: actions/checkout@v4
    
    - name: ğŸ Configurar Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: ğŸ“¦ Instalar dependencias bÃ¡sicas
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: ğŸ” Ejecutar script de verificaciÃ³n
      run: |
        echo "ğŸš€ Iniciando verificaciÃ³n del repositorio..."
        chmod +x verify_repository.sh
        ./verify_repository.sh
    
    - name: ğŸ“Š InformaciÃ³n detallada del sistema
      run: |
        echo "ğŸ–¥ï¸ INFORMACIÃ“N DEL SISTEMA:"
        echo "=========================="
        echo "OS: $(uname -a)"
        echo "Python: $(python --version)"
        echo "Pip: $(pip --version)"
        echo ""
        
        echo "ğŸ’¾ ESPACIO EN DISCO:"
        echo "==================="
        df -h
        echo ""
        
        echo "ğŸ§  MEMORIA:"
        echo "==========="
        free -h
        echo ""
    
    - name: ğŸ“ AnÃ¡lisis de estructura de archivos
      run: |
        echo "ğŸ“‹ ESTRUCTURA DETALLADA DEL REPOSITORIO:"
        echo "========================================"
        
        echo "ğŸ“„ Archivos Python (.py):"
        find . -name "*.py" -not -path "./venv/*" | sort | while read file; do
          lines=$(wc -l < "$file" 2>/dev/null || echo "0")
          echo "   $file ($lines lÃ­neas)"
        done
        
        echo ""
        echo "ğŸ“ Archivos Markdown (.md):"
        find . -name "*.md" | sort | while read file; do
          size=$(wc -c < "$file" 2>/dev/null || echo "0")
          echo "   $file (${size} bytes)"
        done
        
        echo ""
        echo "âš™ï¸ Archivos de configuraciÃ³n (.txt, .yml, .yaml, .json):"
        find . -name "*.txt" -o -name "*.yml" -o -name "*.yaml" -o -name "*.json" | grep -v venv | sort | while read file; do
          size=$(wc -c < "$file" 2>/dev/null || echo "0")
          echo "   $file (${size} bytes)"
        done
    
    - name: ğŸ”¬ VerificaciÃ³n de scripts cientÃ­ficos
      run: |
        echo "ğŸ§ª VERIFICACIÃ“N DE SCRIPTS CIENTÃFICOS:"
        echo "======================================"
        
        scripts=("descargar_datos.py" "analisis_avanzado.py" "analizar_l1.py" "analizar_ringdown.py" "analisis_noesico.py")
        
        for script in "${scripts[@]}"; do
          if [ -f "scripts/$script" ]; then
            echo "âœ… scripts/$script existe"
            lines=$(wc -l < "scripts/$script")
            echo "   ğŸ“Š $lines lÃ­neas de cÃ³digo"
            
            # Verificar sintaxis
            python -m py_compile "scripts/$script" && echo "   âœ… Sintaxis vÃ¡lida" || echo "   âŒ Error de sintaxis"
            
            # Buscar imports crÃ­ticos
            if grep -q "gwpy" "scripts/$script"; then
              echo "   ğŸ“¡ Usa GWpy para datos gravitacionales"
            fi
            if grep -q "matplotlib\|plt" "scripts/$script"; then
              echo "   ğŸ“Š Genera grÃ¡ficos"
            fi
            if grep -q "141.7" "scripts/$script"; then
              echo "   ğŸ¯ Analiza frecuencia objetivo 141.7 Hz"
            fi
          else
            echo "âŒ scripts/$script NO EXISTE"
          fi
          echo ""
        done
    
    - name: ğŸ“š VerificaciÃ³n de documentaciÃ³n
      run: |
        echo "ğŸ“– VERIFICACIÃ“N DE DOCUMENTACIÃ“N:"
        echo "================================"
        
        if [ -f "README.md" ]; then
          echo "âœ… README.md existe"
          words=$(wc -w < README.md)
          echo "   ğŸ“ $words palabras"
          
          if grep -qi "141.*hz" README.md; then
            echo "   ğŸ¯ Menciona la frecuencia objetivo"
          fi
          
          if grep -qi "gw150914" README.md; then
            echo "   ğŸŒŠ Menciona GW150914"
          fi
        else
          echo "âŒ README.md NO EXISTE"
        fi
        
        if [ -f "requirements.txt" ]; then
          echo "âœ… requirements.txt existe"
          packages=$(wc -l < requirements.txt)
          echo "   ğŸ“¦ $packages dependencias listadas"
          
          echo "   ğŸ” Dependencias crÃ­ticas:"
          grep -E "(gwpy|numpy|scipy|matplotlib)" requirements.txt || echo "   âš ï¸ Faltan dependencias crÃ­ticas"
        else
          echo "âŒ requirements.txt NO EXISTE"
        fi
    
    - name: ğŸ¯ Resumen de verificaciÃ³n
      run: |
        echo "ğŸ“‹ RESUMEN DE VERIFICACIÃ“N:"
        echo "=========================="
        
        total_scripts=$(find scripts/ -name "*.py" 2>/dev/null | wc -l || echo "0")
        echo "ğŸ Scripts Python: $total_scripts"
        
        if [ -d "results/figures" ]; then
          figures=$(find results/figures/ -name "*.png" 2>/dev/null | wc -l || echo "0")
          echo "ğŸ“Š Figuras existentes: $figures"
        else
          echo "ğŸ“Š Directorio de figuras: No existe (se crearÃ¡ automÃ¡ticamente)"
        fi
        
        if [ -d "data/raw" ]; then
          data_files=$(find data/raw/ -name "*.hdf5" -o -name "*.h5" 2>/dev/null | wc -l || echo "0")
          echo "ğŸ’¾ Archivos de datos: $data_files"
        else
          echo "ğŸ’¾ Directorio de datos: No existe (se crearÃ¡ automÃ¡ticamente)"
        fi
        
        echo ""
        echo "âœ… VERIFICACIÃ“N COMPLETADA"
        echo "ğŸš€ El repositorio estÃ¡ listo para anÃ¡lisis cientÃ­fico"